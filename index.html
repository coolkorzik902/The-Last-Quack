<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Last Quack | Fast Monster Edition</title>
    <style>
        * { box-sizing: border-box; touch-action: manipulation; -webkit-user-select: none; user-select: none; }
        body { margin: 0; background: #000; color: #0f0; font-family: 'Courier New', monospace; overflow: hidden; height: 100vh; display: flex; justify-content: center; align-items: center; }
        
        #game-wrapper { 
            width: 1920px; height: 1080px; position: relative; background: #000; 
            border: 10px solid #1a1a1a; transform-origin: center; 
        }

        @keyframes doorPunch {
            0% { transform: translate(0, 0); }
            10% { transform: translate(-15px, 20px); }
            30% { transform: translate(15px, -20px); }
            100% { transform: translate(0, 0); }
        }
        .shake-active { animation: doorPunch 0.4s cubic-bezier(.36,.07,.19,.97) both; }

        .awakening { animation: blurOut 2.5s forwards; }
        @keyframes blurOut {
            0% { filter: blur(20px) brightness(0); }
            100% { filter: blur(0px) brightness(1); }
        }

        #viewport { width: 100%; height: 100%; position: relative; transition: transform 0.4s ease-in-out; }
        .room-bg { position: absolute; width: 400%; height: 100%; left: -100%; display: flex; }
        .zone { width: 25%; height: 100%; position: relative; background: #050505; display: flex; justify-content: center; align-items: center; }
        .zone.light-on { background: #1a1a1a !important; box-shadow: inset 0 0 500px #000; }
        
        .door-frame { position: absolute; bottom: 0; width: 800px; height: 100%; left: 50%; transform: translateX(-50%); background: #020202; overflow: hidden; border-top: 20px solid #333; cursor: pointer; }
        .door { 
            position: absolute; width: 100%; height: 100%; background: #1a1a1a; 
            border: 40px solid #222; border-bottom: 80px solid #333;
            z-index: 10; pointer-events: none; top: -100%;
            transition: top 0.25s cubic-bezier(0.6, -0.28, 0.735, 0.045); 
        }
        .door.closed { top: 0 !important; }

        .duck-container { width: 500px; height: 500px; background: #f1c40f; border-radius: 50% 50% 45% 45%; position: relative; cursor: pointer; border-bottom: 20px solid #c7a60a; transition: transform 0.1s; }
        .duck-container:active { transform: scale(0.9); }
        .eye { position: absolute; width: 65px; height: 65px; background: #000; border-radius: 50%; top: 130px; }
        .eye.left { left: 110px; } .eye.right { right: 110px; }
        .beak { position: absolute; width: 190px; height: 100px; background: #e67e22; border-radius: 50px; top: 230px; left: 155px; border-bottom: 10px solid #d35400; }

        .btn-nav { background: #111; color: #f1c40f; border: 4px solid #f1c40f; padding: 25px 45px; font-size: 35px; border-radius: 15px; cursor: pointer; transition: 0.1s; box-shadow: 0 8px 0 #6e5907; position: relative; top: 0; }
        .btn-nav:active { top: 6px; box-shadow: 0 2px 0 #6e5907; }
        .active-light { background: #f1c40f !important; color: #000 !important; top: 6px !important; box-shadow: 0 2px 0 #6e5907 !important; }

        .charge-btn { width: 320px; height: 320px; background: #008b8b; border: 15px solid #0ff; border-radius: 50%; cursor: pointer; color: #fff; font-size: 45px; font-weight: bold; transition: 0.1s; display: flex; align-items: center; justify-content: center; box-shadow: 0 15px 0 #005f5f; }
        .charge-btn:active { transform: translateY(10px); box-shadow: 0 5px 0 #005f5f; }

        #hud { position: absolute; top: 40px; width: 100%; display: flex; justify-content: space-around; font-size: 50px; z-index: 100; text-shadow: 4px 4px #000; }
        .nav-controls { position: absolute; bottom: 60px; width: 100%; display: flex; justify-content: center; gap: 40px; z-index: 100; }

        .xenomorph { position: absolute; bottom: 0; width: 800px; height: 1000px; left: 50%; transform: translateX(-50%); z-index: 5; display: none; background: #0a0a0a; clip-path: polygon(50% 0%, 100% 20%, 100% 80%, 50% 100%, 0% 80%, 0% 20%); }
        .eye-glow { position: absolute; top: 200px; width: 60px; height: 20px; background: #f00; border-radius: 50%; box-shadow: 0 0 120px 50px #f00; }
        
        #jumpscare { position: absolute; inset: 0; background: #100; display: none; z-index: 9000; flex-direction: column; justify-content: center; align-items: center; color: #f00; text-align: center; }
        .insane-mode { animation: insaneShake 0.05s infinite; filter: contrast(2) saturate(0.5) sepia(0.5); }
        @keyframes insaneShake { 0% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -2px); } 100% { transform: translate(2px, 2px); } }
    </style>
</head>
<body onkeydown="handleKey(event, true)" onkeyup="handleKey(event, false)">

<div id="game-wrapper">
    <div id="start-screen" style="position:absolute; inset:0; background:#000; z-index:10000; display:flex; flex-direction:column; justify-content:center; align-items:center;">
        <h1 style="font-size: 120px; color:#f1c40f; margin-bottom: 50px;">THE LAST QUACK</h1>
        <button class="btn-nav" style="font-size: 60px; padding: 40px 100px;" onclick="startGame()">WAKE UP</button>
    </div>

    <div id="jumpscare">
        <h1 style="font-size: 150px;">REALITY COLLAPSED</h1>
        <p id="death-msg" style="font-size: 60px; color: #fff;"></p>
    </div>

    <div id="hud">
        <div id="game-time">12:00 AM</div>
        <div style="color: #0ff;">PWR: <span id="energy-val">100</span>%</div>
        <div style="color: #f0f;">SANITY: <span id="sanity-val">100</span>%</div>
    </div>

    <div id="viewport">
        <div class="room-bg">
            <div class="zone" id="zone-left">
                <div class="door-frame" onmousedown="setDoor('l', true)" onmouseup="setDoor('l', false)">
                    <div id="xeno-left" class="xenomorph"><div class="eye-glow" style="left:200px;"></div><div class="eye-glow" style="right:200px;"></div></div>
                    <div id="door-l" class="door"></div>
                </div>
            </div>
            <div class="zone" id="zone-center">
                <div class="duck-container" onclick="quack()">
                    <div class="eye left"></div><div class="eye right"></div><div class="beak"></div>
                </div>
            </div>
            <div class="zone" id="zone-right">
                <div class="door-frame" onmousedown="setDoor('r', true)" onmouseup="setDoor('r', false)">
                    <div id="xeno-right" class="xenomorph"><div class="eye-glow" style="left:200px;"></div><div class="eye-glow" style="right:200px;"></div></div>
                    <div id="door-r" class="door"></div>
                </div>
            </div>
            <div class="zone" id="zone-back">
                <div class="charge-btn" onmousedown="startCharge()" onmouseup="stopCharge()">RECHARGE</div>
            </div>
        </div>
    </div>

    <div class="nav-controls">
        <button class="btn-nav" onclick="move('left')">LEFT</button>
        <button id="light-btn" class="btn-nav">LIGHT</button>
        <button class="btn-nav" onclick="move('center')">FRONT</button>
        <button class="btn-nav" onclick="move('right')">RIGHT</button>
        <button class="btn-nav" onclick="move('back')">BACK</button>
    </div>
</div>

<script>
    let energy = 100, sanity = 100, hour = 12, minute = 0, gameStarted = false;
    let monsterSide = "", currentZone = "center", isFlashlight = false;
    let doors = { l: false, r: false }, monsterPatience = 0, doorClosedTimer = 0;
    let chargeInterval, menuMusic = [], gameAmbient = [], gameStartTime = 0;

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function createOsc(freq, type = 'sine', vol = 0.1) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start();
        return { osc, gain };
    }

    window.addEventListener('mousedown', () => {
        if (menuMusic.length === 0 && !gameStarted) {
            audioCtx.resume();
            menuMusic = [createOsc(50, 'sine', 0.1), createOsc(55, 'triangle', 0.05)];
        }
    }, {once: false});

    function playHQSound(freq, duration, type = 'sine', vol = 0.1) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(0, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(vol, audioCtx.currentTime + 0.02);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }

    function triggerShake() {
        const wrapper = document.getElementById('game-wrapper');
        wrapper.classList.remove('shake-active');
        void wrapper.offsetWidth;
        wrapper.classList.add('shake-active');
        playHQSound(35, 0.4, 'sine', 0.5);
    }

    function quack() { 
        sanity = Math.min(100, sanity + 15);
        playHQSound(400, 0.2, 'triangle', 0.1); 
    }

    function startGame() {
        if (menuMusic.length > 0) {
            menuMusic.forEach(m => { m.gain.gain.setTargetAtTime(0, audioCtx.currentTime, 1); setTimeout(() => m.osc.stop(), 1000); });
        }
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('game-wrapper').classList.add('awakening');
        gameStarted = true;
        gameStartTime = Date.now();
        gameAmbient = [createOsc(40, 'sine', 0.05), createOsc(42, 'sine', 0.05)];

        setInterval(() => {
            if (!gameStarted) return;
            if (isFlashlight || doors.l || doors.r) energy = Math.max(0, energy - 5);
            if (!isFlashlight && currentZone !== 'center') sanity -= 1.0;
            if (monsterSide !== "" && !doors[monsterSide === 'left' ? 'l' : 'r']) sanity -= 2.0;
            if (currentZone === 'center') sanity = Math.min(100, sanity + 2.5);

            if (monsterSide !== "") {
                let sideKey = monsterSide === 'left' ? 'l' : 'r';
                if (doors[sideKey]) {
                    doorClosedTimer++;
                    // ТЕПЕР МОНСТР ЙДЕ ЧЕРЕЗ 3 СЕКУНДИ
                    if (doorClosedTimer >= 3) { 
                        monsterSide = ""; doorClosedTimer = 0; 
                        playHQSound(25, 1.5, 'sine', 0.3);
                    }
                } else {
                    monsterPatience++;
                    if (monsterPatience >= 15) triggerGameOver("SECURITY BREACH");
                }
            }

            if (sanity < 35) document.getElementById('game-wrapper').classList.add('insane-mode');
            else document.getElementById('game-wrapper').classList.remove('insane-mode');

            if (energy <= 0) triggerGameOver("POWER EXHAUSTED");
            if (sanity <= 0) triggerGameOver("LOST YOUR MIND");

            minute++;
            if (minute >= 60) { minute = 0; hour = (hour === 12) ? 1 : hour + 1; }
            document.getElementById('game-time').innerText = `${hour}:${minute < 10 ? '0' + minute : minute} AM`;
            document.getElementById('energy-val').innerText = Math.floor(energy);
            document.getElementById('sanity-val').innerText = Math.floor(sanity);
        }, 1000);

        setInterval(() => {
            if (!gameStarted) return;
            let elapsed = (Date.now() - gameStartTime) / 1000;
            if (elapsed < 30) return; 

            if (monsterSide === "") {
                if (Math.random() < 0.6) {
                    monsterSide = Math.random() > 0.5 ? "left" : "right";
                    monsterPatience = 0;
                    playHQSound(40, 1, 'triangle', 0.1);
                }
            }
            updateVisuals();
        }, 3000);
    }

    function setDoor(side, isClosed) {
        if (!gameStarted || (isClosed && energy <= 0)) return;
        if (doors[side] === isClosed) return;
        doors[side] = isClosed;
        const el = document.getElementById('door-' + side);
        if (isClosed) {
            el.classList.add('closed');
            setTimeout(triggerShake, 150);
        } else {
            el.classList.remove('closed');
            doorClosedTimer = 0;
        }
        playHQSound(60, 0.2, 'sine', 0.2);
    }

    function startCharge() {
        if (!gameStarted || currentZone !== 'back') return;
        chargeInterval = setInterval(() => { 
            energy = Math.min(100, energy + 4); 
            playHQSound(120, 0.4, 'sine', 0.1); 
        }, 1500);
    }
    function stopCharge() { clearInterval(chargeInterval); }

    function move(to) {
        currentZone = to;
        let x = (to === 'left') ? 1920 : (to === 'right' ? -1920 : (to === 'back' ? -3840 : 0));
        document.getElementById('viewport').style.transform = `translateX(${x}px)`;
        playHQSound(200, 0.1, 'sine', 0.05);
        updateVisuals();
    }

    const lb = document.getElementById('light-btn');
    lb.onmousedown = () => { if (energy > 0 && gameStarted) { isFlashlight = true; lb.classList.add('active-light'); updateVisuals(); } };
    lb.onmouseup = () => { isFlashlight = false; lb.classList.remove('active-light'); updateVisuals(); };

    function updateVisuals() {
        document.querySelectorAll('.zone').forEach(z => z.classList.remove('light-on'));
        if (isFlashlight) document.getElementById('zone-' + currentZone).classList.add('light-on');
        document.getElementById('xeno-left').style.display = (isFlashlight && monsterSide === 'left' && currentZone === 'left' && !doors.l) ? 'block' : 'none';
        document.getElementById('xeno-right').style.display = (isFlashlight && monsterSide === 'right' && currentZone === 'right' && !doors.r) ? 'block' : 'none';
    }

    function triggerGameOver(msg) {
        gameStarted = false;
        if (gameAmbient.length > 0) gameAmbient.forEach(m => m.osc.stop());
        document.getElementById('death-msg').innerText = msg;
        document.getElementById('jumpscare').style.display = 'flex';
        playHQSound(40, 3, 'sine', 0.6);
        setTimeout(() => location.reload(), 5000);
    }

    function handleKey(e, isDown) {
        if (e.code === 'KeyF') isDown ? lb.onmousedown() : lb.onmouseup();
        if (e.code === 'KeyQ') setDoor('l', isDown);
        if (e.code === 'KeyE') setDoor('r', isDown);
        if (isDown) {
            const k = {'KeyA':'left','KeyS':'center','KeyD':'right','KeyW':'back'};
            if (k[e.code]) move(k[e.code]);
        }
    }

    function rescale() {
        const s = Math.min(window.innerWidth / 1920, window.innerHeight / 1080);
        document.getElementById('game-wrapper').style.transform = `scale(${s})`;
    }
    window.addEventListener('resize', rescale); rescale();
</script>
</body>
</html>
