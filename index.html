<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>The Last Quack | Mobile Horror</title>
    <style>
        * { box-sizing: border-box; touch-action: manipulation; -webkit-user-select: none; user-select: none; }
        body { margin: 0; background: #000; color: #0f0; font-family: 'Courier New', monospace; overflow: hidden; height: 100vh; display: flex; justify-content: center; align-items: center; }
        
        #game-wrapper { 
            width: 1920px; height: 1080px; 
            position: relative; background: #000; 
            border: 10px solid #1a1a1a; 
            transform-origin: center; 
        }

        /* Анімація тремтіння */
        @keyframes shake {
            0% { left: 0px; top: 0px; }
            25% { left: 5px; top: -5px; }
            50% { left: -5px; top: 5px; }
            75% { left: 5px; top: 5px; }
            100% { left: 0px; top: 0px; }
        }
        .shaking { animation: shake 0.2s infinite; }

        #wake-up-overlay { position: absolute; inset: 0; z-index: 6000; display: none; pointer-events: none; }
        .eyelid { position: absolute; width: 100%; height: 50%; background: #000; transition: transform 2.5s ease-in-out; }
        .eyelid-top { top: 0; } .eyelid-bottom { bottom: 0; }
        .waking-up .eyelid-top { transform: translateY(-100%); }
        .waking-up .eyelid-bottom { transform: translateY(100%); }

        #start-screen { position: absolute; inset: 0; background: radial-gradient(circle, #1a0505 0%, #000 100%); z-index: 5000; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .title { font-size: 140px; color: #f1c40f; text-shadow: 0 0 20px #f1c40f; margin: 0; }
        .btn-start { background: transparent; color: #f1c40f; border: 5px solid #f1c40f; padding: 30px 80px; font-size: 50px; cursor: pointer; font-weight: bold; margin-top: 40px; transition: transform 0.1s; }
        .btn-start:active { transform: scale(0.9); background: #f1c40f; color: #000; }

        #viewport { width: 100%; height: 100%; position: relative; transition: transform 0.4s ease, filter 3s; filter: blur(30px); }
        .room-bg { position: absolute; width: 300%; height: 100%; left: -100%; display: flex; }
        .zone { width: 33.33%; height: 100%; position: relative; background: #050505; }
        .zone.light-on { background: #151515 !important; box-shadow: inset 0 0 500px #000; }
        
        .door-frame { position: absolute; bottom: 0; width: 800px; height: 100%; left: 50%; transform: translateX(-50%); background: #020202; }
        .door { width: 100%; height: 100%; background: #111; border: 40px solid #1a1a1a; transition: transform 0.2s ease; z-index: 10; pointer-events: none; }
        .door.open { transform: translateY(-92%); }
        .door.closed { transform: translateY(0); }

        .duck-container { width: 500px; height: 500px; background: #f1c40f; border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%; position: relative; cursor: pointer; transition: transform 0.1s; }
        .duck-container:active { transform: scale(0.9); }
        .duck-eye { position: absolute; width: 50px; height: 50px; background: #000; border-radius: 50%; top: 120px; left: 120px; }
        .duck-eye.right { left: 330px; }
        .duck-beak { position: absolute; width: 140px; height: 100px; background: #e67e22; border-radius: 50px; top: 210px; left: 180px; }
        #quack-text { position: absolute; top: -130px; width: 100%; text-align: center; font-size: 110px; color: #f1c40f; opacity: 0; font-weight: bold; pointer-events: none; }

        #hud { position: absolute; top: 40px; width: 100%; display: flex; justify-content: space-around; font-size: 60px; z-index: 100; opacity: 0; transition: 2s; font-weight: bold; pointer-events: none; }
        .nav-controls { position: absolute; bottom: 50px; width: 100%; display: flex; justify-content: center; gap: 30px; z-index: 100; opacity: 0; transition: 2s; }
        
        .btn-nav { 
            background: rgba(0,0,0,0.8); color: #f1c40f; border: 4px solid #f1c40f; 
            padding: 30px 50px; font-size: 35px; font-family: inherit; font-weight: bold; 
            border-radius: 15px; cursor: pointer; transition: transform 0.1s;
        }
        .btn-nav:active { transform: scale(0.85); background: #f1c40f; color: #000; }
        .active-light { background: #f1c40f !important; color: #000 !important; }

        .xenomorph { 
            position: absolute; bottom: 0; width: 800px; height: 1000px; 
            left: 50%; transform: translateX(-50%); z-index: 5; 
            display: none; background: #080808;
            clip-path: polygon(50% 0%, 90% 20%, 100% 60%, 80% 100%, 20% 100%, 0% 60%, 10% 20%);
        }
        .eye-glow { position: absolute; top: 200px; width: 60px; height: 20px; background: #f00; border-radius: 50%; box-shadow: 0 0 60px 20px #f00; }

        #jumpscare-overlay { position: absolute; inset: 0; background: #100; display: none; z-index: 8000; flex-direction: column; justify-content: center; align-items: center; color: #f00; font-size: 80px; }
    </style>
</head>
<body onkeydown="handleKey(event, true)" onkeyup="handleKey(event, false)">

<div id="game-wrapper">
    <div id="wake-up-overlay">
        <div class="eyelid eyelid-top"></div>
        <div class="eyelid eyelid-bottom"></div>
    </div>

    <div id="start-screen">
        <h1 class="title">THE LAST QUACK</h1>
        <button class="btn-start" onclick="initWakeUp()">WAKE UP</button>
    </div>

    <div id="jumpscare-overlay"><h1>DEAD</h1></div>

    <div id="hud">
        <div id="game-time">12:00 AM</div>
        <div style="color: #f0f;">SANITY: <span id="health-val">100</span>%</div>
        <div style="color: #0ff;">POWER: <span id="energy-val">100</span>%</div>
    </div>

    <div id="viewport">
        <div class="room-bg">
            <div class="zone" id="zone-left">
                <div class="door-frame" 
                     onmousedown="setDoor('l', true)" onmouseup="setDoor('l', false)"
                     ontouchstart="setDoor('l', true)" ontouchend="setDoor('l', false)">
                    <div id="xeno-left" class="xenomorph"><div class="eye-glow" style="left:200px;"></div><div class="eye-glow" style="right:200px;"></div></div>
                    <div id="door-l" class="door open"></div>
                </div>
            </div>
            <div class="zone" style="display:flex; justify-content:center; align-items:center;">
                <div class="duck-container" 
                     onmousedown="duckAction()" onmouseup="stopHealing()"
                     ontouchstart="duckAction()" ontouchend="stopHealing()">
                    <div id="quack-text">QUACK!</div>
                    <div class="duck-eye"></div><div class="duck-eye right"></div><div class="duck-beak"></div>
                </div>
            </div>
            <div class="zone" id="zone-right">
                <div class="door-frame" 
                     onmousedown="setDoor('r', true)" onmouseup="setDoor('r', false)"
                     ontouchstart="setDoor('r', true)" ontouchend="setDoor('r', false)">
                    <div id="xeno-right" class="xenomorph"><div class="eye-glow" style="left:200px;"></div><div class="eye-glow" style="right:200px;"></div></div>
                    <div id="door-r" class="door open"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="nav-controls">
        <button class="btn-nav" onclick="move('left')">LEFT</button>
        <button id="light-btn" class="btn-nav" style="color: #ff0; border-color: #ff0;">LIGHT</button>
        <button class="btn-nav" onclick="move('center')">DUCK</button>
        <button class="btn-nav" onclick="move('right')">RIGHT</button>
    </div>
</div>

<script>
    let psyche = 100, energy = 100, monsterSide = "", currentZone = "center", isFlashlight = false;
    let hour = 12, hourIdx = 0, minute = 0, gameStarted = false;
    let doors = { l: false, r: false };

    function rescale() {
        const wrapper = document.getElementById('game-wrapper');
        const scale = Math.min(window.innerWidth / 1920, window.innerHeight / 1080);
        wrapper.style.transform = `scale(${scale})`;
    }
    window.addEventListener('resize', rescale);
    rescale();

    const lightBtn = document.getElementById('light-btn');
    const toggleLight = (val) => {
        if (!gameStarted || energy <= 0) { isFlashlight = false; lightBtn.classList.remove('active-light'); updateVisuals(); return; }
        isFlashlight = val;
        if (isFlashlight) lightBtn.classList.add('active-light');
        else lightBtn.classList.remove('active-light');
        updateVisuals();
    };

    lightBtn.addEventListener('mousedown', () => toggleLight(true));
    lightBtn.addEventListener('mouseup', () => toggleLight(false));
    lightBtn.addEventListener('touchstart', (e) => { e.preventDefault(); toggleLight(true); });
    lightBtn.addEventListener('touchend', (e) => { e.preventDefault(); toggleLight(false); });

    function initWakeUp() {
        document.getElementById('start-screen').style.display = 'none';
        const overlay = document.getElementById('wake-up-overlay');
        overlay.style.display = 'block';
        setTimeout(() => {
            overlay.classList.add('waking-up');
            document.getElementById('viewport').style.filter = 'blur(0px)';
            document.getElementById('hud').style.opacity = '1';
            document.querySelector('.nav-controls').style.opacity = '1';
        }, 100);
        setTimeout(() => { overlay.style.display = 'none'; startGame(); }, 3000);
    }

    function startGame() {
        gameStarted = true;
        setInterval(() => {
            if (!gameStarted) return;
            minute += 2;
            if (minute >= 60) { minute = 0; hour = (hour === 12) ? 1 : hour + 1; hourIdx++; }
            document.getElementById('game-time').innerText = `${hour}:${minute < 10 ? '0' + minute : minute} AM`;
            
            if (isFlashlight) energy -= 2.2;
            if (doors.l) energy -= 1.5;
            if (doors.r) energy -= 1.5;
            
            if (monsterSide !== "" && !doors[monsterSide === 'left' ? 'l' : 'r']) {
                psyche -= 8;
            } else {
                psyche -= 0.3;
            }

            if (energy <= 0) { energy = 0; toggleLight(false); }
            
            document.getElementById('energy-val').innerText = Math.floor(energy);
            document.getElementById('health-val').innerText = Math.floor(psyche);
            
            if (psyche <= 0) {
                document.getElementById('jumpscare-overlay').style.display = 'flex';
                setTimeout(() => location.reload(), 2000);
            }
            if (hour === 6) { alert("WIN!"); location.reload(); }
        }, 1000);

        // ШІ Монстра з перевіркою часу (після 1:00 AM)
        setInterval(() => {
            if (!gameStarted || hourIdx < 1) return; // НЕ З'ЯВЛЯЄТЬСЯ ДО 1 ГОДИНИ
            
            if (monsterSide === "") {
                if (Math.random() < 0.6) {
                    monsterSide = Math.random() > 0.5 ? "left" : "right";
                }
            } else if (doors[monsterSide === 'left' ? 'l' : 'r']) {
                if (Math.random() > 0.6) monsterSide = "";
            }
            updateVisuals();
        }, 2500);
    }

    function move(to) {
        currentZone = to;
        const offset = to === 'left' ? 1920 : (to === 'right' ? -1920 : 0);
        document.getElementById('viewport').style.transform = `translateX(${offset}px)`;
        updateVisuals();
    }

    function handleKey(e, isDown) {
        if (e.code === 'KeyF') toggleLight(isDown);
    }

    function setDoor(side, isClosed) {
        if (energy <= 0 && isClosed) return;
        doors[side] = isClosed;
        document.getElementById('door-' + side).className = isClosed ? "door closed" : "door open";
        updateVisuals();
    }

    function updateVisuals() {
        const wrapper = document.getElementById('game-wrapper');
        document.querySelectorAll('.zone').forEach(z => z.classList.remove('light-on'));
        
        if (isFlashlight && currentZone !== 'center') {
            document.getElementById('zone-' + currentZone).classList.add('light-on');
        }
        
        const showL = isFlashlight && monsterSide === 'left' && currentZone === 'left' && !doors.l;
        const showR = isFlashlight && monsterSide === 'right' && currentZone === 'right' && !doors.r;
        
        document.getElementById('xeno-left').style.display = showL ? 'block' : 'none';
        document.getElementById('xeno-right').style.display = showR ? 'block' : 'none';

        if (monsterSide !== "" && currentZone === monsterSide) wrapper.classList.add('shaking');
        else wrapper.classList.remove('shaking');
    }

    function duckAction() {
        const txt = document.getElementById('quack-text');
        txt.style.opacity = 1;
        setTimeout(() => txt.style.opacity = 0, 300);
        window.hInt = setInterval(() => { if (psyche < 100) psyche += 4; }, 100);
    }
    function stopHealing() { clearInterval(window.hInt); }
</script>
</body>
</html>
